<!DOCTYPE html>
<html lang="zh-Hant">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0">
Â  Â  <title>RPG æˆ°é¬¥ç³»çµ±ç¯„ä¾‹</title>
Â  Â  <style>
Â  Â  Â  Â  /* --- General Styles --- */
Â  Â  Â  Â  body {
font-family: sans-serif;
Â  Â  Â  Â  Â  Â  background-color: #c52222; /* Light gray background for contrast */
display: flex;
Â  Â  Â  Â  Â  Â  justify-content: center;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  min-height: 100vh;
Â  Â  Â  Â  Â  Â  padding: 20px;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* --- Battle Interface Layout --- */
Â  Â  Â  Â  #battle-container {
Â  Â  Â  Â  Â  Â  border: 2px solid #333;
Â  Â  Â  Â  Â  Â  background-color: #ca2f2f;
Â  Â  Â  Â  Â  Â  padding: 20px;
Â  Â  Â  Â  Â  Â  border-radius: 8px;
Â  Â  Â  Â  Â  Â  width: 90%;
Â  Â  Â  Â  Â  Â  max-width: 700px; /* Max width for the battle area */
Â  Â  Â  Â  Â  Â  box-shadow: 0 4px 8px rgba(0,0,0,0.2);
Â  Â  Â  Â  }

Â  Â  Â  Â  #battle-interface {
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  flex-direction: column;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  gap: 20px; /* Space between elements */
Â  Â  Â  Â  }

Â  Â  Â  Â  /* --- Enemy Area --- */
Â  Â  Â  Â  #enemy-area {
Â  Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  Â  Â  background-color: #fff;
Â  Â  Â  Â  Â  Â  padding: 15px;
Â  Â  Â  Â  Â  Â  border-radius: 5px;
Â  Â  Â  Â  Â  Â  border: 1px solid #ccc;
Â  Â  Â  Â  Â  Â  width: 80%;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* --- Player Section (Visual + Panel) --- */
Â  Â  Â  Â  #player-section {
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  justify-content: space-around; /* Space between visual and panel */
Â  Â  Â  Â  Â  Â  align-items: flex-end; /* Align bottom */
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  gap: 20px;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* --- Player Character Visual Area --- */
Â  Â  Â  Â  #player-character-area {
Â  Â  Â  Â  Â  Â  position: relative; /* Needed for absolute positioning of children */
Â  Â  Â  Â  Â  Â  width: 150px;
Â  Â  Â  Â  Â  Â  height: 200px;
Â  Â  Â  Â  Â  Â  flex-shrink: 0; /* Prevent shrinking */
Â  Â  Â  Â  }

Â  Â  Â  Â  #player-character-img {
Â  Â  Â  Â  Â  Â  position: absolute;
Â  Â  Â  Â  Â  Â  bottom: 0;
Â  Â  Â  Â  Â  Â  left: 0;
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  height: auto;
Â  Â  Â  Â  Â  Â  /* transition: transform 0.1s ease-out; Combined with animation */
Â  Â  Â  Â  }

Â  Â  Â  Â  #slash-effect {
Â  Â  Â  Â  Â  Â  position: absolute;
Â  Â  Â  Â  Â  Â  /* Adjust position relative to character */
Â  Â  Â  Â  Â  Â  top: 40%;
Â  Â  Â  Â  Â  Â  left: 60%;
Â  Â  Â  Â  Â  Â  width: 80px;
Â  Â  Â  Â  Â  Â  height: auto;
Â  Â  Â  Â  Â  Â  display: none; /* Initially hidden */
Â  Â  Â  Â  Â  Â  opacity: 0;
Â  Â  Â  Â  Â  Â  transform: rotate(-15deg);
Â  Â  Â  Â  Â  Â  pointer-events: none; /* Prevent interaction */
Â  Â  Â  Â  Â  Â  z-index: 10; /* Ensure effect is above character */
Â  Â  Â  Â  }


Â  Â  Â  Â  /* --- Player Action Panel Grid --- */
Â  Â  Â  Â  #player-panel {
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  max-width: 400px;
Â  Â  Â  Â  }

Â  Â  Â  Â  .player-grid {
Â  Â  Â  Â  Â  Â  display: grid;
Â  Â  Â  Â  Â  Â  grid-template-columns: 1fr 1fr; /* Two equal columns */
Â  Â  Â  Â  Â  Â  grid-template-rows: auto auto auto; /* Three rows, auto height */
Â  Â  Â  Â  Â  Â  gap: 10px;
Â  Â  Â  Â  Â  Â  padding: 10px;
Â  Â  Â  Â  Â  Â  border: 1px solid #555;
Â  Â  Â  Â  Â  Â  background-color: #444; /* Darker panel background */
Â  Â  Â  Â  Â  Â  border-radius: 5px;
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  }

Â  Â  Â  Â  .grid-item {
Â  Â  Â  Â  Â  Â  padding: 10px 15px;
Â  Â  Â  Â  Â  Â  border: 1px solid #666;
Â  Â  Â  Â  Â  Â  border-radius: 4px;
Â  Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  Â  Â  font-size: 0.9em;
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  flex-direction: column;
Â  Â  Â  Â  Â  Â  justify-content: center;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  Â  Â  min-height: 55px;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* --- Button & Status Styles --- */
Â  Â  Â  Â  .action-button {
Â  Â  Â  Â  Â  Â  background-color: #3a5a9a;
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  cursor: pointer;
Â  Â  Â  Â  Â  Â  transition: background-color 0.2s ease, transform 0.1s ease;
Â  Â  Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  }

Â  Â  Â  Â  .action-button:hover:not(:disabled) {
Â  Â  Â  Â  Â  Â  background-color: #507bc7;
Â  Â  Â  Â  }

Â  Â  Â  Â  .action-button:active:not(:disabled) {
Â  Â  Â  Â  Â  Â  background-color: #2a4a8a;
Â  Â  Â  Â  Â  Â  transform: scale(0.98);
Â  Â  Â  Â  }

Â  Â  Â  Â  .action-button:disabled {
Â  Â  Â  Â  Â  Â  background-color: #777;
Â  Â  Â  Â  Â  Â  cursor: not-allowed;
Â  Â  Â  Â  Â  Â  color: #ccc;
Â  Â  Â  Â  }

Â  Â  Â  Â  .status-display {
Â  Â  Â  Â  Â  Â  background-color: #2a2a2a; /* Dark background for status */
Â  Â  Â  Â  Â  Â  color: #eee;
Â  Â  Â  Â  }

Â  Â  Â  Â  .status-display span:first-child { /* HP/MP Label */
Â  Â  Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  Â  Â  margin-bottom: 3px;
Â  Â  Â  Â  Â  Â  font-size: 0.8em;
Â  Â  Â  Â  }
Â  Â  Â  Â  Â .status-display span:last-child { /* HP/MP Text */
Â  Â  Â  Â  Â  Â  font-size: 0.9em;
Â  Â  Â  Â  Â }


Â  Â  Â  Â  /* --- HP/MP Bars --- */
Â  Â  Â  Â  .hp-bar-container, .mp-bar-container {
Â  Â  Â  Â  Â  Â  width: 90%;
Â  Â  Â  Â  Â  Â  height: 8px;
Â  Â  Â  Â  Â  Â  background-color: #555;
Â  Â  Â  Â  Â  Â  border-radius: 4px;
Â  Â  Â  Â  Â  Â  overflow: hidden;
Â  Â  Â  Â  Â  Â  margin: 4px 0;
Â  Â  Â  Â  }

Â  Â  Â  Â  .hp-bar {
Â  Â  Â  Â  Â  Â  height: 100%;
Â  Â  Â  Â  Â  Â  background-color: #4CAF50; /* Green HP */
Â  Â  Â  Â  Â  Â  transition: width 0.3s ease;
Â  Â  Â  Â  Â  Â  border-radius: 4px;
Â  Â  Â  Â  }

Â  Â  Â  Â  .mp-bar {
Â  Â  Â  Â  Â  Â  height: 100%;
Â  Â  Â  Â  Â  Â  background-color: #2196F3; /* Blue MP */
Â  Â  Â  Â  Â  Â  transition: width 0.3s ease;
Â  Â  Â  Â  Â  Â  border-radius: 4px;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* --- Message Log --- */
Â  Â  Â  Â  #message-log {
Â  Â  Â  Â  Â  Â  margin-top: 15px;
Â  Â  Â  Â  Â  Â  padding: 10px;
Â  Â  Â  Â  Â  Â  border: 1px solid #ccc;
Â  Â  Â  Â  Â  Â  background-color: #fff;
Â  Â  Â  Â  Â  Â  color: #333;
Â  Â  Â  Â  Â  Â  min-height: 60px;
Â  Â  Â  Â  Â  Â  max-height: 150px; /* Limit height */
Â  Â  Â  Â  Â  Â  overflow-y: auto; /* Add scroll if needed */
Â  Â  Â  Â  Â  Â  width: 90%;
Â  Â  Â  Â  Â  Â  font-size: 0.9em;
Â  Â  Â  Â  Â  Â  line-height: 1.4;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* --- ANIMATION STYLES --- */

Â  Â  Â  Â  /* Character Lunge Animation */
Â  Â  Â  Â  @keyframes player-lunge {
Â  Â  Â  Â  Â  0% { transform: translateX(0); }
Â  Â  Â  Â  Â  50% { transform: translateX(15px); }
Â  Â  Â  Â  Â  100% { transform: translateX(0); }
Â  Â  Â  Â  }
Â  Â  Â  Â  .player-attacking-lunge {
Â  Â  Â  Â  Â  animation: player-lunge 0.3s ease-in-out forwards;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* Slash Effect Animation */
Â  Â  Â  Â  @keyframes slash-appear-fade {
Â  Â  Â  Â  Â  0% { opacity: 0; transform: scale(0.8) rotate(-15deg); }
Â  Â  Â  Â  Â  50% { opacity: 1; transform: scale(1) rotate(-15deg); }
Â  Â  Â  Â  Â  100% { opacity: 0; transform: scale(1.1) rotate(-15deg); }
Â  Â  Â  Â  }
Â  Â  Â  Â  .slash-effect-active {
Â  Â  Â  Â  Â  display: block !important; /* Override display: none */
Â  Â  Â  Â  Â  animation: slash-appear-fade 0.25s ease-out forwards;
Â  Â  Â  Â  }

Â  Â  </style>
</head>
<body>

Â  Â  <div id="battle-container">
Â  Â  Â  Â  <div id="battle-interface">
Â  Â  Â  Â  Â  Â  <div id="enemy-area">
Â  Â  Â  Â  Â  Â  Â  Â  <p>å“¥å¸ƒæ—</p> <div class="hp-bar-container">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="hp-bar" id="enemy-hp-bar" style="width: 100%;"></div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <p id="enemy-hp-text">HP: 120/120</p>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div id="player-section">
Â  Â  Â  Â  Â  Â  Â  Â  <div id="player-character-area">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <img id="player-character-img" src="è‰¾çˆ¾/è¢å¹•æ“·å–ç•«é¢ 2025-04-10 230633.png" alt="å‹‡è€…è‰¾çˆ¾">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <img id="slash-effect" src="åŠæ°£/pngtree-ink-japanese-samurai-wielding-a-sword-png-image_2829791.jpg" alt="æ–¬æ“Šç‰¹æ•ˆ">
Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <div id="player-panel">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="player-grid">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="attack-button" class="grid-item action-button">æ–¬æ“Š</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="hp-status" class="grid-item status-display">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span>HP</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="hp-bar-container">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="hp-bar" id="player-hp-bar" style="width: 100%;"></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span id="player-hp-text">100/100</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="skill1-button" class="grid-item action-button">ç«çƒè¡“ (MP 10)</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="mp-status" class="grid-item status-display">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span>MP</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="mp-bar-container">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="mp-bar" id="player-mp-bar" style="width: 100%;"></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span id="player-mp-text">50/50</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="skill2-button" class="grid-item action-button">æ²»ç™‚è¡“ (MP 15)</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button id="bag-button" class="grid-item action-button">èƒŒåŒ…</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div> </div> <div id="message-log">æˆ°é¬¥é–‹å§‹ï¼</div>

Â  Â  </div> <script>
Â  Â  Â  Â  // --- DOM Element References ---
Â  Â  Â  Â  const attackButton = document.getElementById('attack-button');
Â  Â  Â  Â  const skill1Button = document.getElementById('skill1-button');
Â  Â  Â  Â  const skill2Button = document.getElementById('skill2-button');
Â  Â  Â  Â  const bagButton = document.getElementById('bag-button');

Â  Â  Â  Â  const playerHpBar = document.getElementById('player-hp-bar');
Â  Â  Â  Â  const playerHpText = document.getElementById('player-hp-text');
Â  Â  Â  Â  const playerMpBar = document.getElementById('player-mp-bar');
Â  Â  Â  Â  const playerMpText = document.getElementById('player-mp-text');

Â  Â  Â  Â  const enemyHpBar = document.getElementById('enemy-hp-bar');
Â  Â  Â  Â  const enemyHpText = document.getElementById('enemy-hp-text');

Â  Â  Â  Â  const messageLog = document.getElementById('message-log');

Â  Â  Â  Â  // Animation Elements
Â  Â  Â  Â  const playerImage = document.getElementById('player-character-img');
Â  Â  Â  Â  const slashEffect = document.getElementById('slash-effect');

Â  Â  Â  Â  // --- Game Data (Simplified) ---
Â  Â  Â  Â  let player = {
Â  Â  Â  Â  Â  Â  name: "å‹‡è€…è‰¾çˆ¾",
Â  Â  Â  Â  Â  Â  maxHp: 100,
Â  Â  Â  Â  Â  Â  currentHp: 100,
Â  Â  Â  Â  Â  Â  maxMp: 50,
Â  Â  Â  Â  Â  Â  currentMp: 50,
Â  Â  Â  Â  Â  Â  attackPower: 15,
Â  Â  Â  Â  Â  Â  skills: [
Â  Â  Â  Â  Â  Â  Â  Â  { name: "ç«çƒè¡“", mpCost: 10, damage: 25, type: 'damage' },
Â  Â  Â  Â  Â  Â  Â  Â  { name: "æ²»ç™‚è¡“", mpCost: 15, heal: 30, type: 'heal' }
Â  Â  Â  Â  Â  Â  ]
Â  Â  Â  Â  };

Â  Â  Â  Â  let enemy = {
Â  Â  Â  Â  Â  Â  name: "å“¥å¸ƒæ—",
Â  Â  Â  Â  Â  Â  maxHp: 120,
Â  Â  Â  Â  Â  Â  currentHp: 120,
Â  Â  Â  Â  Â  Â  attackPower: 10,
Â  Â  Â  Â  Â  Â  defense: 5
Â  Â  Â  Â  };

Â  Â  Â  Â  let isPlayerTurn = true;
Â  Â  Â  Â  let battleEnded = false;

Â  Â  Â  Â  // --- UI Update Function ---
Â  Â  Â  Â  function updateUI() {
Â  Â  Â  Â  Â  Â  if (battleEnded) return;

Â  Â  Â  Â  Â  Â  // Player HP
Â  Â  Â  Â  Â  Â  const playerHpPercent = Math.max(0, (player.currentHp / player.maxHp) * 100);
Â  Â  Â  Â  Â  Â  playerHpBar.style.width = playerHpPercent + '%';
Â  Â  Â  Â  Â  Â  playerHpText.textContent = `${player.currentHp}/${player.maxHp}`;

Â  Â  Â  Â  Â  Â  // Player MP
Â  Â  Â  Â  Â  Â  const playerMpPercent = Math.max(0, (player.currentMp / player.maxMp) * 100);
Â  Â  Â  Â  Â  Â  playerMpBar.style.width = playerMpPercent + '%';
Â  Â  Â  Â  Â  Â  playerMpText.textContent = `${player.currentMp}/${player.maxMp}`;

Â  Â  Â  Â  Â  Â  // Enemy HP
Â  Â  Â  Â  Â  Â  const enemyHpPercent = Math.max(0, (enemy.currentHp / enemy.maxHp) * 100);
Â  Â  Â  Â  Â  Â  enemyHpBar.style.width = enemyHpPercent + '%';
Â  Â  Â  Â  Â  Â  enemyHpText.textContent = `HP: ${enemy.currentHp}/${enemy.maxHp}`;

Â  Â  Â  Â  Â  Â  // Update button states based on turn and resources
Â  Â  Â  Â  Â  Â  attackButton.disabled = !isPlayerTurn;
Â  Â  Â  Â  Â  Â  skill1Button.disabled = !isPlayerTurn || player.currentMp < player.skills[0].mpCost;
Â  Â  Â  Â  Â  Â  skill2Button.disabled = !isPlayerTurn || player.currentMp < player.skills[1].mpCost;
Â  Â  Â  Â  Â  Â  bagButton.disabled = !isPlayerTurn; // Bag usually usable on player turn
Â  Â  Â  Â  }

Â  Â  Â  Â  // --- Message Logging ---
Â  Â  Â  Â  function logMessage(message) {
Â  Â  Â  Â  Â  Â  // Add timestamp for clarity (optional)
Â  Â  Â  Â  Â  Â  // const time = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit', second: '2-digit' });
Â  Â  Â  Â  Â  Â  // messageLog.innerHTML = `[${time}] ${message}<br>` + messageLog.innerHTML;
Â  Â  Â  Â  Â  Â  messageLog.innerHTML = message + '<br>' + messageLog.innerHTML;
Â  Â  Â  Â  Â  Â  messageLog.scrollTop = 0; // Scroll to top to see latest message
Â  Â  Â  Â  Â  Â  console.log(message); // Also log to console for debugging
Â  Â  Â  Â  }

Â  Â  Â  Â  // --- Animation Trigger Function ---
Â  Â  Â  Â  function triggerAttackAnimation() {
Â  Â  Â  Â  Â  Â  if (playerImage.classList.contains('player-attacking-lunge')) {
Â  Â  Â  Â  Â  Â  Â  Â  return; // Don't restart if already animating
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  playerImage.classList.add('player-attacking-lunge');
Â  Â  Â  Â  Â  Â  slashEffect.classList.add('slash-effect-active');

Â  Â  Â  Â  Â  Â  // Remove classes after animation finishes (use longest duration)
Â  Â  Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  Â  Â  playerImage.classList.remove('player-attacking-lunge');
Â  Â  Â  Â  Â  Â  Â  Â  slashEffect.classList.remove('slash-effect-active');
Â  Â  Â  Â  Â  Â  }, 300); // Duration of player-lunge animation
Â  Â  Â  Â  }

Â  Â  Â  Â  // --- Battle Logic Functions ---

Â  Â  Â  Â  function playerTurnAction(actionFn) {
Â  Â  Â  Â  Â  Â  if (!isPlayerTurn || battleEnded) return;
Â  Â  Â  Â  Â  Â  isPlayerTurn = false; // Start action, player can't act again yet
Â  Â  Â  Â  Â  Â  updateUI(); // Disable buttons immediately

Â  Â  Â  Â  Â  Â  actionFn(); // Execute the specific action (attack, skill, bag)

Â  Â  Â  Â  Â  Â  // Check for battle end after player action
Â  Â  Â  Â  Â  Â  Â if (checkBattleEnd()) return;


Â  Â  Â  Â  Â  Â  // If battle continues, delay enemy turn
Â  Â  Â  Â  Â  Â  logMessage("..."); // Pause indicator
Â  Â  Â  Â  Â  Â  setTimeout(enemyTurn, 1500); // Delay for enemy turn (1.5 seconds)
Â  Â  Â  Â  }


Â  Â  Â  Â  function playerAttack() {
Â  Â  Â  Â  Â  Â  Â logMessage(`${player.name} ç™¼å‹•äº†æ–¬æ“Šï¼`);
Â  Â  Â  Â  Â  Â  Â triggerAttackAnimation(); // Trigger animation

Â  Â  Â  Â  Â  Â  Â const damage = Math.max(1, player.attackPower - enemy.defense);
Â  Â  Â  Â  Â  Â  Â enemy.currentHp = Math.max(0, enemy.currentHp - damage);
Â  Â  Â  Â  Â  Â  Â logMessage(`å° ${enemy.name} é€ æˆäº† ${damage} é»å‚·å®³ã€‚`);
Â  Â  Â  Â  Â  Â  Â updateUI(); // Update UI immediately after damage calculation
Â  Â  Â  Â  }

Â  Â  Â  Â  function playerUseSkill(skillIndex) {
Â  Â  Â  Â  Â  Â  const skill = player.skills[skillIndex];

Â  Â  Â  Â  Â  Â  if (player.currentMp >= skill.mpCost) {
Â  Â  Â  Â  Â  Â  Â  Â  player.currentMp -= skill.mpCost;
Â  Â  Â  Â  Â  Â  Â  Â  logMessage(`${player.name} ä½¿ç”¨äº† ${skill.name}ï¼ (æ¶ˆè€— ${skill.mpCost} MP)`);

Â  Â  Â  Â  Â  Â  Â  Â  // TODO: Add skill animations here

Â  Â  Â  Â  Â  Â  Â  Â  if (skill.type === 'damage') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const damage = skill.damage; // Simplified, add defense calc later
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  enemy.currentHp = Math.max(0, enemy.currentHp - damage);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  logMessage(`å° ${enemy.name} é€ æˆäº† ${damage} é»å‚·å®³ã€‚`);
Â  Â  Â  Â  Â  Â  Â  Â  } else if (skill.type === 'heal') {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const healAmount = skill.heal;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  player.currentHp = Math.min(player.maxHp, player.currentHp + healAmount);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  logMessage(`${player.name} æ¢å¾©äº† ${healAmount} é» HPã€‚`);
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â updateUI(); // Update UI after skill effect
Â  Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  Â  Â  logMessage("MP ä¸è¶³ï¼Œç„¡æ³•ä½¿ç”¨æ­¤æŠ€èƒ½ï¼");
Â  Â  Â  Â  Â  Â  Â  Â  // If MP is insufficient, it shouldn't cost the turn.
Â  Â  Â  Â  Â  Â  Â  Â  Â isPlayerTurn = true; // Give turn back immediately
Â  Â  Â  Â  Â  Â  Â  Â  Â updateUI(); // Re-enable buttons
Â  Â  Â  Â  Â  Â  Â  Â  Â // Exit the playerTurnAction flow early
Â  Â  Â  Â  Â  Â  Â  Â  Â // This requires slightly restructuring playerTurnAction or adding flags.
Â  Â  Â  Â  Â  Â  Â  Â  Â // For simplicity now, let's assume insufficient MP still passes the turn.
Â  Â  Â  Â  Â  Â  Â  Â  Â // A better approach would handle this without passing the turn.
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }

Â  Â  Â  Â  function openBag() {
Â  Â  Â  Â  Â  Â  logMessage(`${player.name} æ‰“é–‹äº†èƒŒåŒ…... (åŠŸèƒ½å¾…å¯¦ç¾)`);
Â  Â  Â  Â  Â  Â  // Implement inventory logic here
Â  Â  Â  Â  Â  Â  // For now, let's assume opening bag doesn't immediately end the turn,
Â  Â  Â  Â  Â  Â  // or maybe using an item does.
Â  Â  Â  Â  Â  Â  Â isPlayerTurn = true; // TEMPORARY: Give turn back immediately
Â  Â  Â  Â  Â  Â  Â updateUI();
Â  Â  Â  Â  }

Â  Â  Â  Â  function enemyTurn() {
Â  Â  Â  Â  Â  Â  Â if (battleEnded) return;
Â  Â  Â  Â  Â  Â  logMessage(`è¼ªåˆ° ${enemy.name} çš„å›åˆï¼`);

Â  Â  Â  Â  Â  Â  // Simple AI: Attack
Â  Â  Â  Â  Â  Â  // TODO: Add enemy attack animation
Â  Â  Â  Â  Â  Â  const damage = Math.max(1, enemy.attackPower); // Simplified, add player defense calc later
Â  Â  Â  Â  Â  Â  player.currentHp = Math.max(0, player.currentHp - damage);
Â  Â  Â  Â  Â  Â  logMessage(`${enemy.name} æ”»æ“Šï¼${player.name} å—åˆ°äº† ${damage} é»å‚·å®³ã€‚`);

Â  Â  Â  Â  Â  Â  updateUI();

Â  Â  Â  Â  Â  Â  if (checkBattleEnd()) return;


Â  Â  Â  Â  Â  Â  // End enemy turn, back to player
Â  Â  Â  Â  Â  Â  isPlayerTurn = true;
Â  Â  Â  Â  Â  Â  logMessage(`è¼ªåˆ° ${player.name} äº†ã€‚`);
Â  Â  Â  Â  Â  Â  updateUI(); // Re-enable player buttons
Â  Â  Â  Â  }


Â  Â  Â  Â  function checkBattleEnd() {
Â  Â  Â  Â  Â  Â  if (enemy.currentHp <= 0) {
Â  Â  Â  Â  Â  Â  Â  Â  logMessage(`æ“Šæ•—äº† ${enemy.name}ï¼æˆ°é¬¥å‹åˆ©ï¼ ğŸ‰`);
Â  Â  Â  Â  Â  Â  Â  Â  battleEnded = true;
Â  Â  Â  Â  Â  Â  Â  Â  isPlayerTurn = false; // No more turns
Â  Â  Â  Â  Â  Â  Â  Â  updateUI(); // Disable all buttons permanently
Â  Â  Â  Â  Â  Â  Â  Â  return true; // Battle ended
Â  Â  Â  Â  Â  Â  } else if (player.currentHp <= 0) {
Â  Â  Â  Â  Â  Â  Â  Â  logMessage(`${player.name} çš„ HP æ­¸é›¶... æˆ°é¬¥å¤±æ•—...`);
Â  Â  Â  Â  Â  Â  Â  Â  battleEnded = true;
Â  Â  Â  Â  Â  Â  Â  Â  isPlayerTurn = false; // No more turns
Â  Â  Â  Â  Â  Â  Â  Â  updateUI(); // Disable all buttons permanently
Â  Â  Â  Â  Â  Â  Â  Â  return true; // Battle ended
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â return false; // Battle continues
Â  Â  Â  Â  }


Â  Â  Â  Â  // --- Event Listeners ---
Â  Â  Â  Â  attackButton.addEventListener('click', () => playerTurnAction(playerAttack));
Â  Â  Â  Â  skill1Button.addEventListener('click', () => playerTurnAction(() => playerUseSkill(0)));
Â  Â  Â  Â  skill2Button.addEventListener('click', () => playerTurnAction(() => playerUseSkill(1)));
Â  Â  Â  Â  bagButton.addEventListener('click', () => playerTurnAction(openBag));


Â  Â  Â  Â  // --- Initial Setup ---
Â  Â  Â  Â  logMessage("æˆ°é¬¥ä»‹é¢åˆå§‹åŒ–...");
Â  Â  Â  Â  document.addEventListener('DOMContentLoaded', () => {
Â  Â  Â  Â  Â  Â  updateUI(); // Initial UI setup when DOM is ready
Â  Â  Â  Â  Â  Â  logMessage(`é­é‡ ${enemy.name}ï¼è¼ªåˆ° ${player.name} äº†ã€‚`);
Â  Â  Â  Â  });


Â  Â  </script>

</body>
</html>